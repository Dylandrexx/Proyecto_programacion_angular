import { Component, EventEmitter, Output, inject, input, } from '@angular/core';
import { fromEvent } from 'rxjs';
import { filter, map, startWith, switchMap } from 'rxjs/operators';
import { MapService } from '../map/map.service';
import * as i0 from "@angular/core";
export class LayerComponent {
    mapService = inject(MapService);
    /* Init inputs */
    id = input.required();
    source = input();
    type = input.required();
    metadata = input();
    sourceLayer = input();
    /* Dynamic inputs */
    filter = input();
    layout = input();
    paint = input();
    before = input();
    minzoom = input();
    maxzoom = input();
    layerClick = new EventEmitter();
    layerDblClick = new EventEmitter();
    layerMouseDown = new EventEmitter();
    layerMouseUp = new EventEmitter();
    layerMouseEnter = new EventEmitter();
    layerMouseLeave = new EventEmitter();
    layerMouseMove = new EventEmitter();
    layerMouseOver = new EventEmitter();
    layerMouseOut = new EventEmitter();
    layerContextMenu = new EventEmitter();
    layerTouchStart = new EventEmitter();
    layerTouchEnd = new EventEmitter();
    layerTouchCancel = new EventEmitter();
    layerAdded = false;
    sub;
    ngOnInit() {
        this.sub = this.mapService.mapLoaded$
            .pipe(switchMap(() => fromEvent(this.mapService.mapInstance, 'styledata').pipe(map(() => false), filter(() => !this.mapService.mapInstance.getLayer(this.id())), startWith(true))))
            .subscribe((bindEvents) => this.init(bindEvents));
    }
    ngOnChanges(changes) {
        if (!this.layerAdded) {
            return;
        }
        if (changes['paint'] && !changes['paint'].isFirstChange()) {
            this.mapService.setLayerAllPaintProperty(this.id(), changes['paint'].currentValue);
        }
        if (changes['layout'] && !changes['layout'].isFirstChange()) {
            this.mapService.setLayerAllLayoutProperty(this.id(), changes['layout'].currentValue);
        }
        if (changes['filter'] && !changes['filter'].isFirstChange()) {
            this.mapService.setLayerFilter(this.id(), changes['filter'].currentValue);
        }
        if (changes['before'] && !changes['before'].isFirstChange()) {
            this.mapService.setLayerBefore(this.id(), changes['before'].currentValue);
        }
        if ((changes['minzoom'] && !changes['minzoom'].isFirstChange()) ||
            (changes['maxzoom'] && !changes['maxzoom'].isFirstChange())) {
            this.mapService.setLayerZoomRange(this.id(), this.minzoom(), this.maxzoom());
        }
    }
    ngOnDestroy() {
        if (this.layerAdded) {
            this.mapService.removeLayer(this.id());
        }
        if (this.sub) {
            this.sub.unsubscribe();
        }
    }
    init(bindEvents) {
        const layer = {
            layerOptions: {
                id: this.id(),
                type: this.type(),
                source: this.source(),
                metadata: this.metadata(),
                'source-layer': this.sourceLayer(),
                minzoom: this.minzoom(),
                maxzoom: this.maxzoom(),
                filter: this.filter(),
                layout: this.layout(),
                paint: this.paint(),
            },
            layerEvents: {
                layerClick: this.layerClick,
                layerDblClick: this.layerDblClick,
                layerMouseDown: this.layerMouseDown,
                layerMouseUp: this.layerMouseUp,
                layerMouseEnter: this.layerMouseEnter,
                layerMouseLeave: this.layerMouseLeave,
                layerMouseMove: this.layerMouseMove,
                layerMouseOver: this.layerMouseOver,
                layerMouseOut: this.layerMouseOut,
                layerContextMenu: this.layerContextMenu,
                layerTouchStart: this.layerTouchStart,
                layerTouchEnd: this.layerTouchEnd,
                layerTouchCancel: this.layerTouchCancel,
            },
        };
        this.mapService.addLayer(layer, bindEvents, this.before());
        this.layerAdded = true;
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "20.0.3", ngImport: i0, type: LayerComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
    static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.1.0", version: "20.0.3", type: LayerComponent, isStandalone: true, selector: "mgl-layer", inputs: { id: { classPropertyName: "id", publicName: "id", isSignal: true, isRequired: true, transformFunction: null }, source: { classPropertyName: "source", publicName: "source", isSignal: true, isRequired: false, transformFunction: null }, type: { classPropertyName: "type", publicName: "type", isSignal: true, isRequired: true, transformFunction: null }, metadata: { classPropertyName: "metadata", publicName: "metadata", isSignal: true, isRequired: false, transformFunction: null }, sourceLayer: { classPropertyName: "sourceLayer", publicName: "sourceLayer", isSignal: true, isRequired: false, transformFunction: null }, filter: { classPropertyName: "filter", publicName: "filter", isSignal: true, isRequired: false, transformFunction: null }, layout: { classPropertyName: "layout", publicName: "layout", isSignal: true, isRequired: false, transformFunction: null }, paint: { classPropertyName: "paint", publicName: "paint", isSignal: true, isRequired: false, transformFunction: null }, before: { classPropertyName: "before", publicName: "before", isSignal: true, isRequired: false, transformFunction: null }, minzoom: { classPropertyName: "minzoom", publicName: "minzoom", isSignal: true, isRequired: false, transformFunction: null }, maxzoom: { classPropertyName: "maxzoom", publicName: "maxzoom", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { layerClick: "layerClick", layerDblClick: "layerDblClick", layerMouseDown: "layerMouseDown", layerMouseUp: "layerMouseUp", layerMouseEnter: "layerMouseEnter", layerMouseLeave: "layerMouseLeave", layerMouseMove: "layerMouseMove", layerMouseOver: "layerMouseOver", layerMouseOut: "layerMouseOut", layerContextMenu: "layerContextMenu", layerTouchStart: "layerTouchStart", layerTouchEnd: "layerTouchEnd", layerTouchCancel: "layerTouchCancel" }, usesOnChanges: true, ngImport: i0, template: '', isInline: true });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "20.0.3", ngImport: i0, type: LayerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'mgl-layer',
                    template: '',
                }]
        }], propDecorators: { layerClick: [{
                type: Output
            }], layerDblClick: [{
                type: Output
            }], layerMouseDown: [{
                type: Output
            }], layerMouseUp: [{
                type: Output
            }], layerMouseEnter: [{
                type: Output
            }], layerMouseLeave: [{
                type: Output
            }], layerMouseMove: [{
                type: Output
            }], layerMouseOver: [{
                type: Output
            }], layerMouseOut: [{
                type: Output
            }], layerContextMenu: [{
                type: Output
            }], layerTouchStart: [{
                type: Output
            }], layerTouchEnd: [{
                type: Output
            }], layerTouchCancel: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF5ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3gtbWFwYm94LWdsL3NyYy9saWIvbGF5ZXIvbGF5ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUlaLE1BQU0sRUFFTixNQUFNLEVBQ04sS0FBSyxHQUNOLE1BQU0sZUFBZSxDQUFDO0FBU3ZCLE9BQU8sRUFBRSxTQUFTLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRSxPQUFPLEVBQUUsVUFBVSxFQUFjLE1BQU0sb0JBQW9CLENBQUM7O0FBUzVELE1BQU0sT0FBTyxjQUFjO0lBR2pCLFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFeEMsaUJBQWlCO0lBQ2pCLEVBQUUsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFlLENBQUM7SUFDbkMsTUFBTSxHQUFHLEtBQUssRUFBa0IsQ0FBQztJQUNqQyxJQUFJLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBaUIsQ0FBQztJQUN2QyxRQUFRLEdBQUcsS0FBSyxFQUFxQixDQUFDO0lBQ3RDLFdBQVcsR0FBRyxLQUFLLEVBQXlCLENBQUM7SUFFN0Msb0JBQW9CO0lBQ3BCLE1BQU0sR0FBRyxLQUFLLEVBQW1CLENBQUM7SUFDbEMsTUFBTSxHQUFHLEtBQUssRUFBbUIsQ0FBQztJQUNsQyxLQUFLLEdBQUcsS0FBSyxFQUFrQixDQUFDO0lBQ2hDLE1BQU0sR0FBRyxLQUFLLEVBQW1DLENBQUM7SUFDbEQsT0FBTyxHQUFHLEtBQUssRUFBb0IsQ0FBQztJQUNwQyxPQUFPLEdBQUcsS0FBSyxFQUFvQixDQUFDO0lBRTFCLFVBQVUsR0FBRyxJQUFJLFlBQVksRUFBaUIsQ0FBQztJ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QWU7c0JBQXhCLE1BQU07Z0JBQ0csY0FBYztzQkFBdkIsTUFBTTtnQkFDRyxjQUFjO3NCQUF2QixNQUFNO2dCQUNHLGFBQWE7c0JBQXRCLE1BQU07Z0JBQ0csZ0JBQWdCO3NCQUF6QixNQUFNO2dCQUNHLGVBQWU7c0JBQXhCLE1BQU07Z0JBQ0csYUFBYTtzQkFBdEIsTUFBTTtnQkFDRyxnQkFBZ0I7c0JBQXpCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBpbmplY3QsXG4gIGlucHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB0eXBlIHtcbiAgTGF5ZXIsXG4gIE1hcE1vdXNlRXZlbnQsXG4gIE1hcFRvdWNoRXZlbnQsXG4gIE1hcCxcbiAgU291cmNlU3BlY2lmaWNhdGlvbixcbiAgTGF5ZXJTcGVjaWZpY2F0aW9uLFxufSBmcm9tICdtYXBib3gtZ2wnO1xuaW1wb3J0IHsgZnJvbUV2ZW50LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBzdGFydFdpdGgsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hcFNlcnZpY2UsIFNldHVwTGF5ZXIgfSBmcm9tICcuLi9tYXAvbWFwLnNlcnZpY2UnO1xuaW1wb3J0IHsgTGF5ZXJFdmVudHMgfSBmcm9tICcuLi9tYXAvbWFwLnR5cGVzJztcblxudHlwZSBBbnlMYXllclNvdXJjZSA9IExheWVyU3BlY2lmaWNhdGlvblsnc291cmNlJ10gfCBTb3VyY2VTcGVjaWZpY2F0aW9uO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtZ2wtbGF5ZXInLFxuICB0ZW1wbGF0ZTogJycsXG59KVxuZXhwb3J0IGNsYXNzIExheWVyQ29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgTGF5ZXJFdmVudHNcbntcbiAgcHJpdmF0ZSBtYXBTZXJ2aWNlID0gaW5qZWN0KE1hcFNlcnZpY2UpO1xuXG4gIC8qIEluaXQgaW5wdXRzICovXG4gIGlkID0gaW5wdXQucmVxdWlyZWQ8TGF5ZXJbJ2lkJ10+KCk7XG4gIHNvdXJjZSA9IGlucHV0PEFueUxheWVyU291cmNlPigpO1xuICB0eXBlID0gaW5wdXQucmVxdWlyZWQ8TGF5ZXJbJ3R5cGUnXT4oKTtcbiAgbWV0YWRhdGEgPSBpbnB1dDxMYXllclsnbWV0YWRhdGEnXT4oKTtcbiAgc291cmNlTGF5ZXIgPSBpbnB1dDxMYXllclsnc291cmNlLWxheWVyJ10+KCk7XG5cbiAgLyogRHluYW1pYyBpbnB1dHMgKi9cbiAgZmlsdGVyID0gaW5wdXQ8TGF5ZXJbJ2ZpbHRlciddPigpO1xuICBsYXlvdXQgPSBpbnB1dDxMYXllclsnbGF5b3V0J10+KCk7XG4gIHBhaW50ID0gaW5wdXQ8TGF5ZXJbJ3BhaW50J10+KCk7XG4gIGJlZm9yZSA9IGlucHV0PFBhcmFtZXRlcnM8TWFwWydtb3ZlTGF5ZXInXT5bMV0+KCk7XG4gIG1pbnpvb20gPSBpbnB1dDxMYXllclsnbWluem9vbSddPigpO1xuICBtYXh6b29tID0gaW5wdXQ8TGF5ZXJbJ21heHpvb20nXT4oKTtcblxuICBAT3V0cHV0KCkgbGF5ZXJDbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyRGJsQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPE1hcE1vdXNlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBsYXllck1vdXNlRG93biA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyTW91c2VVcCA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyTW91c2VFbnRlciA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyTW91c2VMZWF2ZSA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyTW91c2VNb3ZlID0gbmV3IEV2ZW50RW1pdHRlcjxNYXBNb3VzZUV2ZW50PigpO1xuICBAT3V0cHV0KCkgbGF5ZXJNb3VzZU92ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPE1hcE1vdXNlRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBsYXllck1vdXNlT3V0ID0gbmV3IEV2ZW50RW1pdHRlcjxNYXBNb3VzZUV2ZW50PigpO1xuICBAT3V0cHV0KCkgbGF5ZXJDb250ZXh0TWVudSA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwTW91c2VFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyVG91Y2hTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8TWFwVG91Y2hFdmVudD4oKTtcbiAgQE91dHB1dCgpIGxheWVyVG91Y2hFbmQgPSBuZXcgRXZlbnRFbWl0dGVyPE1hcFRvdWNoRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBsYXllclRvdWNoQ2FuY2VsID0gbmV3IEV2ZW50RW1pdHRlcjxNYXBUb3VjaEV2ZW50PigpO1xuXG4gIHByaXZhdGUgbGF5ZXJBZGRlZCA9IGZhbHNlO1xuICBwcml2YXRlIHN1YjogU3Vic2NyaXB0aW9uO1xuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc3ViID0gdGhpcy5tYXBTZXJ2aWNlLm1hcExvYWRlZCRcbiAgICAgIC5waXBlKFxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT5cbiAgICAgICAgICBmcm9tRXZlbnQodGhpcy5tYXBTZXJ2aWNlLm1hcEluc3RhbmNlLCAnc3R5bGVkYXRhJykucGlwZShcbiAgICAgICAgICAgIG1hcCgoKSA9PiBmYWxzZSksXG4gICAgICAgICAgICBmaWx0ZXIoKCkgPT4gIXRoaXMubWFwU2VydmljZS5tYXBJbnN0YW5jZS5nZXRMYXllcih0aGlzLmlkKCkpKSxcbiAgICAgICAgICAgIHN0YXJ0V2l0aCh0cnVlKSxcbiAgICAgICAgICApLFxuICAgICAgICApLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoYmluZEV2ZW50czogYm9vbGVhbikgPT4gdGhpcy5pbml0KGJpbmRFdmVudHMpKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoIXRoaXMubGF5ZXJBZGRlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlc1sncGFpbnQnXSAmJiAhY2hhbmdlc1sncGFpbnQnXS5pc0ZpcnN0Q2hhbmdlKCkpIHtcbiAgICAgIHRoaXMubWFwU2VydmljZS5zZXRMYXllckFsbFBhaW50UHJvcGVydHkoXG4gICAgICAgIHRoaXMuaWQoKSxcbiAgICAgICAgY2hhbmdlc1sncGFpbnQnXS5jdXJyZW50VmFsdWUhLFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZXNbJ2xheW91dCddICYmICFjaGFuZ2VzWydsYXlvdXQnXS5pc0ZpcnN0Q2hhbmdlKCkpIHtcbiAgICAgIHRoaXMubWFwU2VydmljZS5zZXRMYXllckFsbExheW91dFByb3BlcnR5KFxuICAgICAgICB0aGlzLmlkKCksXG4gICAgICAgIGNoYW5nZXNbJ2xheW91dCddLmN1cnJlbnRWYWx1ZSEsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlc1snZmlsdGVyJ10gJiYgIWNoYW5nZXNbJ2ZpbHRlciddLmlzRmlyc3RDaGFuZ2UoKSkge1xuICAgICAgdGhpcy5tYXBTZXJ2aWNlLnNldExheWVyRmlsdGVyKFxuICAgICAgICB0aGlzLmlkKCksXG4gICAgICAgIGNoYW5nZXNbJ2ZpbHRlciddLmN1cnJlbnRWYWx1ZSEsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlc1snYmVmb3JlJ10gJiYgIWNoYW5nZXNbJ2JlZm9yZSddLmlzRmlyc3RDaGFuZ2UoKSkge1xuICAgICAgdGhpcy5tYXBTZXJ2aWNlLnNldExheWVyQmVmb3JlKFxuICAgICAgICB0aGlzLmlkKCksXG4gICAgICAgIGNoYW5nZXNbJ2JlZm9yZSddLmN1cnJlbnRWYWx1ZSEsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICAoY2hhbmdlc1snbWluem9vbSddICYmICFjaGFuZ2VzWydtaW56b29tJ10uaXNGaXJzdENoYW5nZSgpKSB8fFxuICAgICAgKGNoYW5nZXNbJ21heHpvb20nXSAmJiAhY2hhbmdlc1snbWF4em9vbSddLmlzRmlyc3RDaGFuZ2UoKSlcbiAgICApIHtcbiAgICAgIHRoaXMubWFwU2VydmljZS5zZXRMYXllclpvb21SYW5nZShcbiAgICAgICAgdGhpcy5pZCgpLFxuICAgICAgICB0aGlzLm1pbnpvb20oKSxcbiAgICAgICAgdGhpcy5tYXh6b29tKCksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmxheWVyQWRkZWQpIHtcbiAgICAgIHRoaXMubWFwU2VydmljZS5yZW1vdmVMYXllcih0aGlzLmlkKCkpO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdWIpIHtcbiAgICAgIHRoaXMuc3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0KGJpbmRFdmVudHM6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBsYXllcjogU2V0dXBMYXllciA9IHtcbiAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICBpZDogdGhpcy5pZCgpLFxuICAgICAgICB0eXBlOiB0aGlzLnR5cGUoKSxcbiAgICAgICAgc291cmNlOiB0aGlzLnNvdXJjZSgpLFxuICAgICAgICBtZXRhZGF0YTogdGhpcy5tZXRhZGF0YSgpLFxuICAgICAgICAnc291cmNlLWxheWVyJzogdGhpcy5zb3VyY2VMYXllcigpLFxuICAgICAgICBtaW56b29tOiB0aGlzLm1pbnpvb20oKSxcbiAgICAgICAgbWF4em9vbTogdGhpcy5tYXh6b29tKCksXG4gICAgICAgIGZpbHRlcjogdGhpcy5maWx0ZXIoKSxcbiAgICAgICAgbGF5b3V0OiB0aGlzLmxheW91dCgpLFxuICAgICAgICBwYWludDogdGhpcy5wYWludCgpLFxuICAgICAgfSxcbiAgICAgIGxheWVyRXZlbnRzOiB7XG4gICAgICAgIGxheWVyQ2xpY2s6IHRoaXMubGF5ZXJDbGljayxcbiAgICAgICAgbGF5ZXJEYmxDbGljazogdGhpcy5sYXllckRibENsaWNrLFxuICAgICAgICBsYXllck1vdXNlRG93bjogdGhpcy5sYXllck1vdXNlRG93bixcbiAgICAgICAgbGF5ZXJNb3VzZVVwOiB0aGlzLmxheWVyTW91c2VVcCxcbiAgICAgICAgbGF5ZXJNb3VzZUVudGVyOiB0aGlzLmxheWVyTW91c2VFbnRlcixcbiAgICAgICAgbGF5ZXJNb3VzZUxlYXZlOiB0aGlzLmxheWVyTW91c2VMZWF2ZSxcbiAgICAgICAgbGF5ZXJNb3VzZU1vdmU6IHRoaXMubGF5ZXJNb3VzZU1vdmUsXG4gICAgICAgIGxheWVyTW91c2VPdmVyOiB0aGlzLmxheWVyTW91c2VPdmVyLFxuICAgICAgICBsYXllck1vdXNlT3V0OiB0aGlzLmxheWVyTW91c2VPdXQsXG4gICAgICAgIGxheWVyQ29udGV4dE1lbnU6IHRoaXMubGF5ZXJDb250ZXh0TWVudSxcbiAgICAgICAgbGF5ZXJUb3VjaFN0YXJ0OiB0aGlzLmxheWVyVG91Y2hTdGFydCxcbiAgICAgICAgbGF5ZXJUb3VjaEVuZDogdGhpcy5sYXllclRvdWNoRW5kLFxuICAgICAgICBsYXllclRvdWNoQ2FuY2VsOiB0aGlzLmxheWVyVG91Y2hDYW5jZWwsXG4gICAgICB9LFxuICAgIH07XG4gICAgdGhpcy5tYXBTZXJ2aWNlLmFkZExheWVyKGxheWVyLCBiaW5kRXZlbnRzLCB0aGlzLmJlZm9yZSgpKTtcbiAgICB0aGlzLmxheWVyQWRkZWQgPSB0cnVlO1xuICB9XG59XG4iXX0=